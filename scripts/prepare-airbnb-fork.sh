#!/bin/bash
# Prefix package name with `@irbnb/`
ag '  "name":' -G 'packages\/.+\/package\.json$' -l | xargs sed -E -e 's#"(metro-transform-worker|metro-babel-register|metro-transform-plugins|metro-minify-terser|metro-inspector-proxy|metro-resolver|buck-worker-tool|metro-cache|metro-symbolicate|metro-react-native-babel-transformer|metro|ob1|metro-core|metro-babel-transformer|metro-react-native-babel-preset|metro-config|metro-memory-fs|metro-source-map|metro-minify-uglify)"#"@irbnb\/\1"#' -i

# Change package references accordingly
ag "((import.+)from\ |require(\.resolve)?\()'(metro-transform-worker|metro-babel-register|metro-transform-plugins|metro-minify-terser|metro-inspector-proxy|metro-resolver|buck-worker-tool|metro-cache|metro-symbolicate|metro-react-native-babel-transformer|metro|ob1|metro-core|metro-babel-transformer|metro-react-native-babel-preset|metro-config|metro-memory-fs|metro-source-map|metro-minify-uglify)(.+)?'\)?" -l | xargs sed -E -e "s#require(\.resolve)?\('(metro-transform-worker|metro-babel-register|metro-transform-plugins|metro-minify-terser|metro-inspector-proxy|metro-resolver|buck-worker-tool|metro-cache|metro-symbolicate|metro-react-native-babel-transformer|metro|ob1|metro-core|metro-babel-transformer|metro-react-native-babel-preset|metro-config|metro-memory-fs|metro-source-map|metro-minify-uglify)(\/.+)?'\)#require\1\('@irbnb\/\2\3'\)#" -i

ag "((import.+)from\ |require(\.resolve)?\()'(metro-transform-worker|metro-babel-register|metro-transform-plugins|metro-minify-terser|metro-inspector-proxy|metro-resolver|buck-worker-tool|metro-cache|metro-symbolicate|metro-react-native-babel-transformer|metro|ob1|metro-core|metro-babel-transformer|metro-react-native-babel-preset|metro-config|metro-memory-fs|metro-source-map|metro-minify-uglify)(.+)?'\)?" -l | xargs sed -E -e "s#(import.+)from\ '(metro-transform-worker|metro-babel-register|metro-transform-plugins|metro-minify-terser|metro-inspector-proxy|metro-resolver|buck-worker-tool|metro-cache|metro-symbolicate|metro-react-native-babel-transformer|metro|ob1|metro-core|metro-babel-transformer|metro-react-native-babel-preset|metro-config|metro-memory-fs|metro-source-map|metro-minify-uglify)(\/.+)?';#\1from\ '@irbnb\/\2\3';#" -i
